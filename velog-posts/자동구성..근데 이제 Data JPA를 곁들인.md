<blockquote>
<h3 id="ì˜¤ëŠ˜ì˜-ëª©í‘œ">ì˜¤ëŠ˜ì˜ ëª©í‘œ</h3>
<p><strong>TransactionManager</strong>, <strong>EntityManagerFactory</strong>, <strong>Datasource</strong>ê°€ ì–¸ì œ <strong>ìë™êµ¬ì„±</strong>ë˜ëŠ”ì§€ ì´í•´í•˜ê¸°</p>
</blockquote>
<p><code>Spring</code> ê³¼ <code>Spring Boot</code>ì˜ ì—¬ëŸ¬ ì°¨ì´ì  ì¤‘ ìë™êµ¬ì„±ì´ ì¡´ì¬í•©ë‹ˆë‹¤.
ì´ ê¸€ì—ì„œëŠ” <code>Data JPA</code>ë¥¼ ì‚¬ìš©í•˜ëŠ” í™˜ê²½ì—ì„œëŠ” ì–´ë– í•œ ê³¼ì •ì„ ê±°ì³ <strong>ìë™êµ¬ì„±</strong>ì´ ì„¤ì •ë˜ëŠ”ì§€ ì•Œì•„ë³´ê³ ì í•©ë‹ˆë‹¤. </p>
<h3 id="spring-vs-spring-boot">Spring vs Spring Boot</h3>
<blockquote>
<p>Springì€ ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì˜ í•µì‹¬ ëª¨ë“ˆì„ ëª¨ì•„ì„œ ë§Œë“  í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. Springì—ì„œëŠ” ê°œë°œìê°€ ì§ì ‘ ì„¤ì • íŒŒì¼ì„ ì‘ì„±í•˜ì—¬ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ êµ¬ì„±í•˜ê³ , í•„ìš”í•œ ë¹ˆ ê°ì²´ë¥¼ ë“±ë¡í•˜ê³ , ë¹ˆ ê°ì²´ ê°„ì˜ ì˜ì¡´ì„±ì„ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤. Springì€ íŠ¹ì •í•œ êµ¬ì„±ì„ ìœ„í•´ ì¶”ê°€ì ì¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
ë°˜ë©´, Spring BootëŠ” ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ë¥¼ ë³´ë‹¤ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë§Œë“  í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. Spring Bootì—ì„œëŠ” ê°œë°œìê°€ ì„¤ì • íŒŒì¼ì„ ì‘ì„±í•  í•„ìš” ì—†ì´, <strong>í”„ë¡œì íŠ¸ì˜ ì„¤ì •ê³¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ì¡´ì„±ì„ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì£¼ëŠ” ê¸°ëŠ¥</strong>ì„ ì œê³µí•©ë‹ˆë‹¤.</p>
</blockquote>
<p>ìš°ì„  í”„ë¡œì íŠ¸ ì„¤ì •ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>
<ul>
<li><code>Spring Boot 3.2.4</code></li>
<li><code>dependencies</code>
<img alt="" src="https://velog.velcdn.com/images/ho-tea/post/78bb14b2-b8a6-4d10-80b1-a95abc817227/image.png" /></li>
<li><code>application.properties</code>
<img alt="" src="https://velog.velcdn.com/images/ho-tea/post/ebb294dd-8060-4cc2-ad82-9516ef06fd55/image.png" /></li>
</ul>
<hr />
<h3 id="ë¼ì´ë¸ŒëŸ¬ë¦¬-í›‘ì–´ë³´ê¸°">ë¼ì´ë¸ŒëŸ¬ë¦¬ í›‘ì–´ë³´ê¸°</h3>
<p><code>spring-boot-starter</code>ë¥¼ ë””íœë˜ì‹œë¡œ ì„¤ì •í•´ë†“ìœ¼ë©´ ì•„ë˜ì™€ ê°™ì´ ìë™ìœ¼ë¡œ <code>autoconfigure</code> ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p><img alt="" src="https://velog.velcdn.com/images/ho-tea/post/5c75cb56-e579-4332-ac73-fc7f2587c773/image.png" /></p>
<p><code>spring-boot-starter</code> ë¥¼ í†µí•´ ì¶”ê°€ëœ <code>autoconfigure</code> ì•ˆì—ì„œ 
<code>DataSourceAutoConfiguration</code>ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ”ë°, <code>DataSourceAutoConfiguration</code>ëŠ” <code>Datasource</code>ë¥¼ ìë™ìœ¼ë¡œ ë“±ë¡í•´ì£¼ëŠ” í´ë˜ìŠ¤ì…ë‹ˆë‹¤.
<img alt="" src="https://velog.velcdn.com/images/ho-tea/post/b74ff2bc-51dd-4e35-8ab3-606bc20e58b3/image.png" /></p>
<hr />
<h3 id="datasourceautoconfiguration">DataSourceAutoConfiguration</h3>
<p>ì´ í´ë˜ìŠ¤ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì„ ìœ„í•œ <code>DataSource</code> ë¹ˆì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ê³  êµ¬ì„±í•˜ëŠ” ì—­í• ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.
<img alt="" src="https://velog.velcdn.com/images/ho-tea/post/eb781f69-3344-4b34-8f26-14ce16fbacb6/image.png" /></p>
<p>ì—¬ê¸°ì„œëŠ” í¬ê²Œ 3ê°€ì§€ ì„¤ì •ë“¤ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<ul>
<li><p>*<em>EnableConfigurationProperties({DataSourceProperties.class}) : *</em>ì™¸ë¶€ ì„¤ì • íŒŒì¼ì˜ <code>DataSource</code> ê´€ë ¨ í”„ë¡œí¼í‹°ë¥¼ ë°”ì¸ë”©í•©ë‹ˆë‹¤.</p>
</li>
<li><p><strong>EmbeddedDatabaseCondition :</strong> ì´ ì¡°ê±´ì€ <code>spring.datasource.url</code> ì†ì„±ì´ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ë¹„ì–´ìˆì„ ê²½ìš°, ë‚´ì¥í˜• ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì„±ì„ í™œì„±í™”í•˜ê¸° ìœ„í•œ ì¡°ê±´ì…ë‹ˆë‹¤.</p>
</li>
</ul>
<p>ë§ˆì§€ë§‰ í•˜ë‚˜ëŠ” <strong>@ConditionalOnMissingBean({DataSource.class, XADataSource.class})</strong> ì…ë‹ˆë‹¤.
    <img alt="" src="https://velog.velcdn.com/images/ho-tea/post/a6e42602-d978-4028-b761-0d1122379c11/image.png" /></p>
<p><code>DataSourceAutoConfiguration</code>ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ì— ë‹¨ í•˜ë‚˜ì˜ <code>DataSource</code> ë¹ˆì´ ìˆì„ ë•Œë§Œ ìƒˆ <code>DataSource</code> ë¹ˆì„ ìƒì„±í•˜ë„ë¡ ì„¤ê³„ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í‰ê°€í•˜ëŠ” ì¡°ê±´ ì¤‘ í•˜ë‚˜ëŠ” <strong>@ConditionalOnMissingBean({DataSource.class, XADataSource.class})</strong>ì™€, ë‚´ë¶€ì ìœ¼ë¡œ ë‹¨ì¼ í›„ë³´ ì¡°ê±´ì„ í™•ì¸í•˜ê¸° ìœ„í•´ OnSingleCandidateCondition (ì¦‰, @ConditionalOnSingleCandidateì˜ ì²˜ë¦¬ í´ë˜ìŠ¤)ì´ ì‚¬ìš©ë©ë‹ˆë‹¤. -&gt; [ê´€ë ¨ ë¸”ë¡œê·¸ ì£¼ì†Œ]</p>
<p>ë§Œì•½ <code>application.yml</code>ì´ë‚˜ ì½”ë“œìƒì—ì„œ <code>DataSource</code>ê°€ 2ê°œ ë“±ë¡ë˜ì–´ ìˆë‹¤ë©´, ìë™ êµ¬ì„± ì¡°ê±´ì´ ë§Œì¡±ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¦‰, ì´ë¯¸ ë‘ ê°œ ì´ìƒì˜ <code>DataSource</code> ë¹ˆì´ ì¡´ì¬í•˜ë¯€ë¡œ, <code>DataSourceAutoConfiguration</code>ì˜ ì¡°ê±´ì´ ì¶©ì¡±ë˜ì§€ ì•Šì•„ ìë™ìœ¼ë¡œ <code>DataSource</code>ë¥¼ ìƒì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
<p>ì´ ê²½ìš° ì–´ë–»ê²Œ ë ê¹Œìš”?</p>
<p><strong>ìë™ êµ¬ì„± ë™ì‘</strong></p>
<ul>
<li><code>DataSourceAutoConfiguration</code> ë‚´ë¶€ì˜ ì¡°ê±´ë“¤(ì˜ˆ, <code>EmbeddedDatabaseCondition</code>, <code>PooledDataSourceCondition</code> ë“±)ì´ ëª¨ë‘ <code>Bean</code>ì´ ì´ë¯¸ ì¡´ì¬í•œë‹¤ëŠ” ì‚¬ì‹¤ì— ì˜í•´ ë¬´ì‹œë©ë‹ˆë‹¤. ë”°ë¼ì„œ, ìë™ êµ¬ì„± í´ë˜ìŠ¤ ë‚´ì—ì„œ <code>DataSource</code>ë¥¼ ìƒì„±í•˜ëŠ” <code>PooledDataSourceConfiguration</code>ì´ë‚˜ <code>EmbeddedDatabaseConfiguration</code> ê°™ì€ ë‚´ë¶€ êµ¬ì„± í´ë˜ìŠ¤ë“¤ì€ í˜¸ì¶œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
</ul>
<p><strong>ê°œë°œì ì—­í• </strong></p>
<ul>
<li>ìë™ êµ¬ì„±ì´ ì‹¤í–‰ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ê°œë°œìê°€ ì§ì ‘ <code>DataSource</code> ë¹ˆë“¤ì„ êµ¬ì„±í•´ì•¼ í•©ë‹ˆë‹¤. ë§Œì•½ ìë™ êµ¬ì„±ì„ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´, ì—¬ëŸ¬ <code>DataSource</code> ì¤‘ í•˜ë‚˜ë¥¼ <code>@Primary</code>ë¡œ ì§€ì •í•˜ì—¬ ë‹¨ì¼ í›„ë³´ë¡œ ì¸ì‹ë˜ë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´, <code>OnSingleCandidateCondition</code> ì¡°ê±´ì´ ë§Œì¡±ë˜ì–´ ìë™ êµ¬ì„±ì—ì„œ í•´ë‹¹ <code>DataSource</code>ì— ëŒ€í•´ ì¶”ê°€ì ì¸ ì„¤ì •(ì˜ˆ: íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì € ë“±)ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>
<p><code>DataSourceAutoConfiguration</code>ì„ í†µí•´ ìë™ìœ¼ë¡œ <code>Datasourceë¥¼</code> ë“±ë¡í•´ì£¼ëŠ” ê²ƒê³¼ ê°™ì´ 
<code>Spring Data JPA</code>ë¥¼ ì‚¬ìš©í•˜ë©´ <code>HibernateJpaAutoConfiguration</code>ì™€ <code>JpaRepositoriesAutoConfiguration</code>ê°€ í•¨ê»˜ ì‘ë™í•˜ì—¬ <code>TransactionManager</code>, <code>EntityManagerFactory</code> ë“± <code>JPA</code>ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ê¸°ë³¸ ë¹ˆë“¤ì„ ìë™ìœ¼ë¡œ ìƒì„±Â·ë“±ë¡í•©ë‹ˆë‹¤.</p>
<blockquote>
<ul>
<li><strong>HibernateJpaAutoConfiguration:</strong> ì´ í´ë˜ìŠ¤ëŠ” EntityManagerFactory, PlatformTransactionManager ë“± JPA í™˜ê²½ì— í•„ìš”í•œ í•µì‹¬ ë¹ˆë“¤ì„ ìë™ìœ¼ë¡œ ë“±ë¡í•©ë‹ˆë‹¤.</li>
</ul>
</blockquote>
<ul>
<li><strong>JpaRepositoriesAutoConfiguration:</strong> ì´ í´ë˜ìŠ¤ëŠ” Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ìŠ¤ìº”í•˜ê³  ë“±ë¡í•˜ì—¬, ë³„ë„ì˜ êµ¬í˜„ì²´ ì—†ì´ë„ CRUD ë° ì»¤ìŠ¤í…€ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.</li>
</ul>
<p>ì´ë ‡ê²Œ ë‘ ìë™ êµ¬ì„± í´ë˜ìŠ¤ê°€ í•¨ê»˜ ë™ì‘í•¨ìœ¼ë¡œì¨, ê°œë°œìëŠ” ë³µì¡í•œ ì„¤ì • ì—†ì´ <code>Spring Data JPA</code> ê¸°ëŠ¥ì„ ì†ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<hr />
<h3 id="jparepositoriesautoconfiguration">JpaRepositoriesAutoConfiguration</h3>
<p>ìš°ì„  <strong>JpaRepositoriesAutoConfiguration ë¥¼ ê°„ëµíˆ ì‚´í´ë³´ìë©´,</strong>
ì´ í´ë˜ìŠ¤ëŠ” <code>Spring Boot</code>ì—ì„œ <code>JPA</code> ê¸°ë°˜ì˜ <code>Repository</code>ë¥¼ ìë™ êµ¬ì„±í•˜ê¸° ìœ„í•œ <code>auto-configuration</code> í´ë˜ìŠ¤ë¡œ ì•„ë˜ì™€ ê°™ì€ ì• ë…¸í…Œì´ì…˜ë“¤ì´ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
<p><img alt="" src="https://velog.velcdn.com/images/ho-tea/post/79ee070e-9454-4b6c-8a0e-10ff7b2d496b/image.png" /></p>
<ul>
<li><p><strong>@AutoConfiguration(after = {HibernateJpaAutoConfiguration.class, TaskExecutionAutoConfiguration.class}) :</strong> ì´ ì„¤ì •ì€ <code>Hibernate JPA</code>ì™€ <code>Task Execution</code> ê´€ë ¨ ìë™ êµ¬ì„±ë“¤ì´ ë¨¼ì € ì™„ë£Œëœ í›„ì— ì´ ì„¤ì •ì´ ì ìš©ë˜ë„ë¡ ìˆœì„œë¥¼ ë³´ì¥í•©ë‹ˆë‹¤.</p>
</li>
<li><p><strong>@ConditionalOnBean({DataSource.class}) :</strong> <code>DataSource</code> ë¹ˆì´ ì¡´ì¬í•´ì•¼ ì´ <code>auto-configuration</code>ì´ í™œì„±í™”ë©ë‹ˆë‹¤. ì¦‰, ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„¤ì •ì´ ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</p>
</li>
<li><p><strong>@ConditionalOnClass({JpaRepository.class}) :</strong> í´ë˜ìŠ¤íŒ¨ìŠ¤ì— <code>JpaRepository</code> í´ë˜ìŠ¤ê°€ ìˆì–´ì•¼ JPA ë¦¬í¬ì§€í† ë¦¬ ê¸°ëŠ¥ì´ í™œì„±í™”ë©ë‹ˆë‹¤.    </p>
</li>
</ul>
<blockquote>
<p><code>Data JPA</code>ê°€ ì•„ë‹Œ <code>Jpa</code>ë¥¼ ì‚¬ìš©í•˜ê²Œ ëœë‹¤ë©´ <code>HibernateJpaAutoConfiguration</code> í´ë˜ìŠ¤ë§Œì„ ì‚¬ìš©í•˜ê³ , <code>JpaRepositoriesAutoConfiguration</code> í´ë˜ìŠ¤ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
</blockquote>
<h3 id="hibernatejpaautoconfiguration">HibernateJpaAutoConfiguration</h3>
<p>í•´ë‹¹ í´ë˜ìŠ¤ì—ì„œëŠ” <code>EntityManagerFactory</code>, <code>PlatformTransactionManager</code> ë“± <code>JPA</code> í™˜ê²½ì— í•„ìš”í•œ í•µì‹¬ ë¹ˆë“¤ì„ ìë™ìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ê³¼ì •ì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.
í•´ë‹¹ í´ë˜ìŠ¤ì˜ ì• ë…¸í…Œì´ì…˜ë“¤ì„ í™•ì¸í•˜ê²Œ ë˜ë©´ ì¡°ê¸ˆì€ ìµìˆ™í•œ(?) í´ë˜ìŠ¤ëª…ì´ ë³´ì…ë‹ˆë‹¤.</p>
<blockquote>
<p><code>DataSourceAutoConfiguration</code> ì„ <code>after</code>ì— ì§€ì •í•˜ëŠ” ì½”ë“œê°€ ë³´ì´ëŠ”ë°, í•´ë‹¹ <code>DataSourceAutoConfiguration</code>ëŠ” ì´ˆë°˜ì— ì–¸ê¸‰í–ˆë˜ <code>DataSource</code>ë¥¼ ìë™êµ¬ì„±í•˜ëŠ” í´ë˜ìŠ¤ì…ë‹ˆë‹¤.</p>
</blockquote>
<p><img alt="" src="https://velog.velcdn.com/images/ho-tea/post/6edc02f4-8793-48e5-b24e-afc868c86e5f/image.png" /></p>
<pre><code class="language-java">// code
package org.springframework.boot.autoconfigure.orm.jpa;

import jakarta.persistence.EntityManager;
import org.hibernate.engine.spi.SessionImplementor;
import org.springframework.boot.autoconfigure.AutoConfiguration;
import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
import org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;
import org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration;
import org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration;
import org.springframework.boot.autoconfigure.transaction.TransactionManagerCustomizationAutoConfiguration;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Import;
import org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;

@AutoConfiguration(
    after = {DataSourceAutoConfiguration.class, TransactionManagerCustomizationAutoConfiguration.class},
    before = {TransactionAutoConfiguration.class, DataSourceTransactionManagerAutoConfiguration.class}
)
@ConditionalOnClass({LocalContainerEntityManagerFactoryBean.class, EntityManager.class, SessionImplementor.class})
@EnableConfigurationProperties({JpaProperties.class})
@Import({HibernateJpaConfiguration.class})
public class HibernateJpaAutoConfiguration {
    public HibernateJpaAutoConfiguration() {
    }
}
</code></pre>
<p>í•´ë‹¹ ì• ë…¸í…Œì´ì…˜ì— êµ¬ì„±ëœ ì„¤ì • ê°’ ëŒ€í•´ì„œë„ ê°„ëµíˆ ì•Œê³  ë„˜ì–´ê°€ê² ìŠµë‹ˆë‹¤.</p>
<pre><code class="language-java">@AutoConfiguration(
    after = {DataSourceAutoConfiguration.class, TransactionManagerCustomizationAutoConfiguration.class}, 
    before = {TransactionAutoConfiguration.class, DataSourceTransactionManagerAutoConfiguration.class})</code></pre>
<ul>
<li><strong>after:</strong> ë°ì´í„° ì†ŒìŠ¤ ë° íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì € ê´€ë ¨ ì„¤ì •ì´ ë¨¼ì € ì™„ë£Œëœ í›„ì— ì´ êµ¬ì„± í´ë˜ìŠ¤ê°€ ì ìš©ë©ë‹ˆë‹¤.</li>
<li><strong>before:</strong> ì´í›„ì— ì‹¤í–‰ë˜ëŠ” íŠ¸ëœì­ì…˜ ê´€ë ¨ ìë™ êµ¬ì„±ë³´ë‹¤ ë¨¼ì € ì´ êµ¬ì„±ì´ ì²˜ë¦¬ë˜ì–´ì•¼ í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</li>
</ul>
<p>í•´ë‹¹ ì• ë…¸í…Œì´ì…˜ì€ <code>HibernateJpaAutoConfiguration</code>ê°€ ì‹¤í–‰ë˜ëŠ” ì‹œì ì„ ì œì–´í•˜ëŠ”ë°, ì´ëŠ” <code>JpaTransactionManager</code> êµ¬ì„±ê³¼ ë°€ì ‘í•˜ê²Œ ê´€ë ¨ë©ë‹ˆë‹¤. ì¡°ê¸ˆ ë” ìì„¸íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<ul>
<li><p><strong>after ì†ì„±:</strong> <code>DataSourceAutoConfiguration</code>ì™€ <code>TransactionManagerCustomizationAutoConfiguration</code>ê°€ ë¨¼ì € ì‹¤í–‰ë˜ì–´, ë°ì´í„°ì†ŒìŠ¤ì™€ íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ì— ëŒ€í•œ ê¸°ë³¸ ì„¤ì • ë° ì¶”ê°€ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ì™„ë£Œëœ ìƒíƒœì—¬ì•¼ í•©ë‹ˆë‹¤.</p>
<ul>
<li><p>ì—¬ê¸°ì„œ ì£¼ì˜í•´ì•¼ í•  ë¶€ë¶„ì€ <code>TransactionManagerCustomizationAutoConfiguration</code>ëŠ” <code>JpaTransactionManager</code>ë¥¼ <strong>ì§ì ‘</strong> ìƒì„±í•˜ëŠ” ê³³ì´ ì•„ë‹™ë‹ˆë‹¤.</p>
</li>
<li><p><code>JpaTransactionManager</code>ëŠ” ì£¼ë¡œ <code>JpaBaseConfiguration</code>(ê·¸ë¦¬ê³  ì´ë¥¼ ìƒì†ë°›ì€ <code>HibernateJpaConfiguration</code>)ì—ì„œ <code>EntityManagerFactory</code>ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.</p>
</li>
<li><p><code>TransactionManagerCustomizationAutoConfiguration</code>ëŠ” ì´ë¯¸ ìƒì„±ëœ <code>TransactionManager</code>ì— ëŒ€í•´ ì¶”ê°€ì ì¸ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì„ ì ìš©í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. <code>JpaTransactionManager</code>ì˜ ê¸°ë³¸ ìƒì„±ì€ <code>HibernateJpaConfiguration</code>ì—ì„œ ì§„í–‰ë˜ê³ (<code>HibernateJpaAutoConfiguration X</code>), ê·¸ ì´í›„ì— <code>TransactionManagerCustomizationAutoConfiguration</code>ê°€ ì¡´ì¬í•˜ë©´, ì´ë¥¼ ì´ìš©í•´ ì¶”ê°€ì ì¸ ì„¤ì •ì´ë‚˜ ìˆ˜ì •ì„ ì ìš©í•©ë‹ˆë‹¤. </p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>ë°©ê¸ˆ ë‹¤ë£¬ ë¶€ë¶„ì€ ë°‘ì—ì„œ í•œë²ˆ ë” ë‹¤ë£¨ë‹ˆ ì§€ê¸ˆì€ ê·¸ëƒ¥ 
<code>&quot;JpaBaseConfigurationê°€ JpaTransactionManagerë¥¼ ìƒì„±í•˜ëŠ”êµ¬ë‚˜!&quot;</code> ì •ë„ë¡œë§Œ ì´í•´í•˜ì…”ë„ ê´œì°®ìŠµë‹ˆë‹¤.</p>
</blockquote>
<ul>
<li><strong>before ì†ì„±:</strong> <code>TransactionAutoConfiguration</code>ì™€ <code>DataSourceTransactionManagerAutoConfiguration</code>ë³´ë‹¤ ë¨¼ì € ì‹¤í–‰ë˜ì–´, <code>JPA</code> ê´€ë ¨ ë¹ˆë“¤(ì˜ˆ: <code>EntityManagerFactory</code>, <code>JpaTransactionManager</code> ë“±)ì´ ë“±ë¡ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</li>
</ul>
<p>ì´ëŸ¬í•œ ìˆœì„œ ë•ë¶„ì— <code>HibernateJpaAutoConfiguration</code>ëŠ” í•„ìš”í•œ ë¹ˆë“¤ì´ ì´ë¯¸ êµ¬ì„±ëœ ìƒíƒœì—ì„œ ì‹¤í–‰ë˜ë©°, ê·¸ í›„ì— ì „ì²´ íŠ¸ëœì­ì…˜ ê´€ë ¨ ìë™ êµ¬ì„±ì´ ì´ë£¨ì–´ì§€ë„ë¡ ë³´ì¥ë©ë‹ˆë‹¤.</p>
<hr />
<pre><code class="language-java">@ConditionalOnClass({
        LocalContainerEntityManagerFactoryBean.class, 
         EntityManager.class, 
        SessionImplementor.class})</code></pre>
<ul>
<li>ì´ ì¡°ê±´ì€ ë‹¤ìŒê³¼ ê°™ì€ í´ë˜ìŠ¤ë“¤ì´ í´ë˜ìŠ¤íŒ¨ìŠ¤ì— ì¡´ì¬í•  ë•Œë§Œ Hibernate ê¸°ë°˜ì˜ JPA ìë™ êµ¬ì„±ì´ í™œì„±í™”ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.<ul>
<li><code>LocalContainerEntityManagerFactoryBean</code>: EntityManagerFactoryë¥¼ ìƒì„±í•˜ëŠ” Spring ORMì˜ í•µì‹¬ í´ë˜ìŠ¤</li>
<li><code>EntityManager</code>: JPA í‘œì¤€ ì¸í„°í˜ì´ìŠ¤</li>
<li><code>SessionImplementor</code>: Hibernateì˜ ë‚´ë¶€ ì„¸ì…˜ ì¸í„°í˜ì´ìŠ¤</li>
</ul>
</li>
</ul>
<p>ì¦‰, JPAì™€ Hibernate ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¡´ì¬í•´ì•¼ ì´ ìë™ êµ¬ì„±ì´ ì ìš©ë©ë‹ˆë‹¤.</p>
<hr />
<pre><code class="language-java">@EnableConfigurationProperties({JpaProperties.class})</code></pre>
<ul>
<li><code>JpaProperties</code> í´ë˜ìŠ¤ì— ì •ì˜ëœ ì™¸ë¶€ ì„¤ì •(ì˜ˆ: <code>application.properties</code> ë˜ëŠ” <code>application.yml</code> íŒŒì¼ì˜ <code>spring.jpa.*</code> ê´€ë ¨ ì„¤ì •)ì´ ìë™ìœ¼ë¡œ ë°”ì¸ë”©ë˜ì–´, ê°œë°œìê°€ ì„¤ì •í•œ ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ Hibernate ê´€ë ¨ ë¹ˆë“¤ì´ êµ¬ì„±ë©ë‹ˆë‹¤.
<img alt="" src="https://velog.velcdn.com/images/ho-tea/post/17149899-7eda-493b-bfa6-6ab1b0580807/image.png" /></li>
</ul>
<hr />
<pre><code class="language-java">@Import({HibernateJpaConfiguration.class})</code></pre>
<ul>
<li>ì‹¤ì œ Hibernate JPA ì„¤ì •ì„ ë‹´ë‹¹í•˜ëŠ” <code>HibernateJpaConfiguration</code> í´ë˜ìŠ¤ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.</li>
<li>ì´ í´ë˜ìŠ¤ì—ì„œëŠ” <code>EntityManagerFactory</code>, <code>EntityManager</code> ë° ê¸°íƒ€ <code>Hibernate</code> ê´€ë ¨ ë¹ˆë“¤ì„ ë“±ë¡í•˜ëŠ” ì‘ì—…ì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.</li>
</ul>
<h3 id="hibernatejpaconfiguration">HibernateJpaConfiguration</h3>
<p>ìŠ¤í”„ë§ì—ì„œ ìë°” ì„¤ì •ì„ ì¶”ê°€í•  ë•Œ ì‚¬ìš©í•˜ëŠ” <code>Import</code>ë¥¼ íƒ€ê³  ë“¤ì–´ê°€ê²Œ ëœë‹¤ë©´ <code>ì‹¤ì œ Hibernate JPA ì„¤ì •</code>ì„ ë‹´ë‹¹í•˜ëŠ” <code>HibernateJpaConfiguration</code> í´ë˜ìŠ¤ê°€ ë‚˜ì˜¤ê²Œ ë˜ëŠ”ë° ì—¬ê¸°ì„œ ì£¼ì˜í•´ì•¼ í•  ë¶€ë¶„ì€ <strong>@ConditionalOnSingleCandidate(DataSource.class) ì…ë‹ˆë‹¤.</strong> </p>
<p><img alt="" src="https://velog.velcdn.com/images/ho-tea/post/e8968d59-703d-439a-b89e-9a26b70a52b7/image.png" /></p>
<p>ì´ í´ë˜ìŠ¤ëŠ” <strong>@ConditionalOnSingleCandidate(DataSource.class)</strong> ì¡°ê±´ì´ ë¶™ì–´ ìˆì–´ì„œ, <code>DataSource</code> ë¹ˆì´ ë‹¨ í•˜ë‚˜ì¼ ë•Œë§Œ ìë™ êµ¬ì„±ë©ë‹ˆë‹¤.</p>
<p><strong>ì¦‰, ì—¬ëŸ¬ ê°œì˜ DataSourceê°€ ë“±ë¡ë˜ì–´ ìˆìœ¼ë©´ ì´ ì¡°ê±´ì´ ì¶©ì¡±ë˜ì§€ ì•Šì•„ HibernateJpaConfigurationì´ ìë™ìœ¼ë¡œ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</strong></p>
<ul>
<li><strong>HibernateJpaConfiguration</strong>ì´ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ìë™ìœ¼ë¡œ <strong>JpaTransactionManager</strong>ë‚˜ <strong>EntityManagerFactory</strong>ì™€ ê°™ì€ JPA ê´€ë ¨ í•µì‹¬ ë¹ˆë“¤ì´ ìƒì„±ë˜ì§€ ì•Šê²Œ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ìˆ˜ë™ìœ¼ë¡œ í•´ë‹¹ ì„¤ì •ì„ ì§„í–‰í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.</li>
</ul>
<blockquote>
<p>ìˆ˜ë™ìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ë°©ë²• ì™¸ì—ë„ ì—¬ëŸ¬ ê°œì˜ <code>DataSource</code>ê°€ ë“±ë¡ë˜ì–´ ìˆì„ ë•Œ, ê·¸ ì¤‘ í•˜ë‚˜ë¥¼ <code>@Primary</code>ë¡œ ì§€ì •í•˜ë©´ í•´ë‹¹ <code>DataSource</code>ê°€ ë‹¨ì¼ í›„ë³´ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ <code>@ConditionalOnSingleCandidate(DataSource.class)</code> ì¡°ê±´ì„ ì¶©ì¡±í•˜ì—¬ <code>HibernateJpaConfiguration</code>ê°€ ìë™ìœ¼ë¡œ ë™ì‘í•˜ê²Œ ë©ë‹ˆë‹¤.</p>
</blockquote>
<h3 id="jpabaseconfiguration">JpaBaseConfiguration</h3>
<p>í•´ë‹¹ í´ë˜ìŠ¤(<code>HibernateJpaConfiguration</code>)ëŠ”  <code>JpaBaseConfiguration</code> ë¥¼ ìƒì†ë°›ê³  ìˆìŠµë‹ˆë‹¤. <code>JpaBaseConfiguration</code> ì—ì„œ ì¤‘ì ì ìœ¼ë¡œ ë³¼ ë¶€ë¶„ì€ í¬ê²Œ ë‘ê°€ì§€ì…ë‹ˆë‹¤.</p>
<ul>
<li><strong>íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì € ë¹ˆ ë“±ë¡</strong></li>
<li><strong>EntityManagerFactory ë¹ˆ ë“±ë¡</strong></li>
</ul>
<p><strong>íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì € ë¹ˆ ë“±ë¡</strong></p>
<ul>
<li><code>transactionManager</code> ë©”ì„œë“œëŠ” <code>JpaTransactionManager</code>ë¥¼ ìƒì„±í•˜ê³ , ì¶”ê°€ì ì¸ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì„ ì ìš©í•©ë‹ˆë‹¤. ë§Œì•½ <code>TransactionManager</code> ë¹ˆì´ ì—†ì„ ê²½ìš°ì—ë§Œ ìƒì„±í•˜ë„ë¡ ì¡°ê±´ë¶€(<code>@ConditionalOnMissingBean</code>)ë¡œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
  <img alt="" src="https://velog.velcdn.com/images/ho-tea/post/48bc5438-69d9-4aaa-ad84-5cd4d36bfeed/image.png" /></li>
</ul>
<p><strong>EntityManagerFactory ë¹ˆ ë“±ë¡</strong></p>
<ul>
<li><code>entityManagerFactory</code> ë©”ì„œë“œì—ì„œëŠ” <code>entityManagerFactoryBuilder()</code>ë¥¼ ì´ìš©í•´ <code>LocalContainerEntityManagerFactoryBean</code>ì„ ìƒì„±í•©ë‹ˆë‹¤. 
ì´ ë¹ˆì€ ì‹¤ì œë¡œ <code>JPA</code>ì˜ <code>EntityManagerFactory</code>ë¥¼ êµ¬ì„±í•˜ë©°, ì—¬ê¸°ì„œ ë°ì´í„° ì†ŒìŠ¤, ê´€ë¦¬ ëŒ€ìƒ í´ë˜ìŠ¤, ì¶”ê°€ì ì¸ <code>JPA</code> ì†ì„±ë“¤ì´ ì ìš©ë©ë‹ˆë‹¤.
<img alt="" src="https://velog.velcdn.com/images/ho-tea/post/b7cedc46-7cad-4541-8f75-419a27e6bb65/image.png" /><blockquote>
<p><code>LocalContainerEntityManagerFactoryBean</code>ëŠ” <code>Spring Framework</code>ì—ì„œ ì œê³µí•˜ëŠ” <code>FactoryBean</code>ìœ¼ë¡œ, <code>JPA</code>ì˜ <code>EntityManagerFactory</code>ë¥¼ ìƒì„±í•˜ê³  êµ¬ì„±í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. 
ì´ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì™€ í†µí•©ëœ ë°©ì‹ìœ¼ë¡œ <code>JPA</code> ì„¤ì •ì„ ì†ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, <code>ë°ì´í„° ì†ŒìŠ¤</code>, <code>JPA ë²¤ë” ì–´ëŒ‘í„°</code>, <code>ì—”í‹°í‹° íŒ¨í‚¤ì§€ ìŠ¤ìº”</code>, <code>ì¶”ê°€ JPA ì†ì„±</code> ë“±ì„ í•œ ê³³ì—ì„œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
<img alt="" src="https://velog.velcdn.com/images/ho-tea/post/918f9cb0-4f66-4b86-a088-eaa528c3d18a/image.png" /></p>
</blockquote>
</li>
</ul>
<hr />
<p><code>HibernateJpaConfiguration</code>ì™€ <code>JpaBaseConfiguration</code>ì„ í†µí•´ ìš°ë¦¬ê°€ í”íˆ ì ‘í•˜ëŠ” <code>JpaTransactionManager</code>ì™€ <code>EntityManagerFactory</code>ê°€ ìë™ìœ¼ë¡œ ìƒì„±ëœë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë¬¼ë¡  ì´ë ‡ê²Œ ë‚´ë¶€ íë¦„ì„ ìì„¸íˆ ì•Œì§€ ì•Šë”ë¼ë„ <code>Spring Data JPA</code>ë¥¼ ì‚¬ìš©í•˜ëŠ” ë° í° ë¬¸ì œëŠ” ì—†ì§€ë§Œ,
<code>â€œìš°ë¦¬ê°€ ë¨¹ëŠ” í•œ í†¨ì˜ ìŒ€ì—ë„ ë†ë¶€ë“¤ì˜ ë•€ê³¼ ì •ì„±ì´ ë‹´ê²¨ ìˆë‹¤â€</code>ëŠ” ë§ì²˜ëŸ¼, í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•˜ëŠ” <code>Spring Boot</code> ë‚´ë¶€ì—ëŠ” ìˆ˜ë§ì€ ìë™ êµ¬ì„± ë©”ì»¤ë‹ˆì¦˜ê³¼ ì •êµí•œ ì„¤ê³„ê°€ ìˆ¨ì–´ ìˆë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>
<h3 id="ğŸ’¡-ê·¸ë˜ì„œ-ìˆœì„œê°€-ì–´ë–»ê²Œ-ëœë‹¤ê³ ">ğŸ’¡ ê·¸ë˜ì„œ ìˆœì„œê°€ ì–´ë–»ê²Œ ëœë‹¤ê³ ..?</h3>
<ul>
<li><strong>DataSourceAutoConfiguration</strong><ul>
<li>ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ <code>DataSource</code> ë¹ˆì„ ìƒì„±í•©ë‹ˆë‹¤. (ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°, ì»¤ë„¥ì…˜ í’€ ë“±)</li>
</ul>
</li>
<li><strong>TransactionManagerCustomizationAutoConfiguration</strong><ul>
<li>ê¸°ë³¸ íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €(ì˜ˆ: DataSourceTransactionManager)ê°€ ìƒì„±ë˜ê¸° ì „ì—, í•„ìš”í•œ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì„ ì ìš©í•©ë‹ˆë‹¤.</li>
</ul>
</li>
<li><strong>HibernateJpaAutoConfiguration</strong><ul>
<li>ìœ„ì˜ ë‘ ë‹¨ê³„(<code>DataSource</code>ì™€ íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì € ì»¤ìŠ¤í„°ë§ˆì´ì§•)ê°€ ì™„ë£Œëœ í›„ ì‹¤í–‰ë©ë‹ˆë‹¤.</li>
<li>ì´ ë‹¨ê³„ì—ì„œ HibernateJpaAutoConfigurationì´ <strong>HibernateJpaConfiguration</strong>ì„ ì„í¬íŠ¸í•©ë‹ˆë‹¤.</li>
</ul>
</li>
<li><strong>HibernateJpaConfiguration (JpaBaseConfiguration ê¸°ë°˜)</strong><ul>
<li><strong>JpaVendorAdapter</strong>ë¥¼ ìƒì„± ë° ë“±ë¡í•˜ì—¬, Hibernate ë“± JPA ê³µê¸‰ì íŠ¹í™” ì„¤ì •ì„ ì ìš©í•©ë‹ˆë‹¤.</li>
<li><strong>EntityManagerFactoryBuilder</strong>ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</li>
<li><strong>LocalContainerEntityManagerFactoryBean</strong>ë¥¼ ë“±ë¡í•˜ì—¬ ì‹¤ì œ JPAì˜ <code>EntityManagerFactory</code>ë¥¼ ìƒì„±í•˜ë©°, ì´ ë¹ˆì€ @Primaryë¡œ ë“±ë¡ë©ë‹ˆë‹¤.</li>
<li><strong>PlatformTransactionManager</strong> (ë³´í†µ <code>JpaTransactionManager</code>)ë¥¼ ìƒì„± ë° ë“±ë¡í•©ë‹ˆë‹¤.</li>
</ul>
</li>
<li><strong>JpaRepositoriesAutoConfiguration</strong><ul>
<li>Spring Data JPAì˜ Repository ì¸í„°í˜ì´ìŠ¤ë“¤ì„ ìŠ¤ìº”í•˜ì—¬, JPA Repository ë¹ˆë“¤ì„ ìë™ìœ¼ë¡œ ë“±ë¡í•©ë‹ˆë‹¤.</li>
</ul>
</li>
<li><strong>TransactionAutoConfiguration</strong><ul>
<li>ìœ„ì—ì„œ ë“±ë¡í•œ íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ ê¸°ë°˜ìœ¼ë¡œ, @Transactional ë“±ì˜ ì„ ì–¸ì  íŠ¸ëœì­ì…˜ ê´€ë¦¬ë¥¼ ìœ„í•œ AOP ì„¤ì • ë° ì¸í”„ë¼ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.</li>
</ul>
</li>
</ul>