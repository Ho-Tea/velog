<blockquote>
<p><strong>ë³¸ í”„ë¡œì íŠ¸ëŠ” í† ìŠ¤ í˜ì´ë¨¼ì¸  ê²°ì œ APIë¥¼ í™œìš©í•œ ë°©íƒˆì¶œ ì˜ˆì•½ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</strong></p>
</blockquote>
<p>í•´ë‹¹ ê¸€ì€ ì•„ë˜ì˜ <code>3ê°€ì§€ ì¡°ê±´</code>ì— ê¸°ë°˜í•˜ì—¬ ê²°ì œ API ì—°ë™ ê³¼ì •ì—ì„œ íŠ¸ëœì­ì…˜ ê´€ë¦¬, ì›ìì„± ë³´ì¥, ë°ì´í„° ë¬´ê²°ì„± í™•ë³´ ë“±ì„ ìœ„í•´ ì„ íƒí•œ ê¸°ìˆ ì  ì ‘ê·¼ ë°©ì‹ì— ëŒ€í•´ ì„¤ëª…í•©ë‹ˆë‹¤. </p>
<ul>
<li><input checked="" disabled="" type="checkbox" /> <strong>ì¡°ê±´ 1 : ê²°ì œ ë„ë©”ì¸ì˜ ê²½ìš°, ëˆì´ ì˜¤ê°€ëŠ” ë¯¼ê°í•œ íŠ¸ëœì­ì…˜ì„ ì²˜ë¦¬í•˜ë¯€ë¡œ ë°ì´í„°ì˜ ì •í™•ì„±ê³¼ ì¼ê´€ì„±ì´ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤.</strong></li>
</ul>
<p><strong>â†’ <code>íŠ¸ëœì­ì…˜ ë¶„ë¦¬ ì „ëµ</code> = <a href="https://velog.io/@ho-tea/%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EB%B6%84%EB%A6%AC-%EC%A0%84%EB%9E%B5%EC%9C%BC%EB%A1%9C-%EA%B0%95%ED%95%9C%EC%B5%9C%EC%A2%85-%EC%9D%BC%EA%B4%80%EC%84%B1-%EB%B3%B4%EC%9E%A5">ğŸ”— ê²°ì œ API - íŠ¸ëœì­ì…˜ ë¶„ë¦¬ ì „ëµìœ¼ë¡œ ê°•í•œ/ìµœì¢… ì¼ê´€ì„± ë³´ì¥</a></strong></p>
<ul>
<li><input checked="" disabled="" type="checkbox" /> <strong>ì¡°ê±´ 2 : ë°©íƒˆì¶œì„ ì˜ˆì•½í•˜ëŠ” ê³¼ì •ì—ì„œ ì‚¬ìš©ìëŠ” ì¶œê¸ˆ ê²°ê³¼ì™€ ì˜ˆì•½ ê²°ê³¼ë¥¼ ì•Œê³  ë„˜ì–´ê°€ì•¼í•˜ê¸° ë•Œë¬¸ì— ë™ê¸°ë¡œ êµ¬ì„±í•´ì•¼ í•œë‹¤.</strong></li>
</ul>
<p><strong>â†’ <code>ëª¨ë“  ì‘ì—…ì„ ë™ê¸° ë°©ì‹ìœ¼ë¡œ êµ¬ì„±</code>  = <a href="https://velog.io/@ho-tea/%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EB%B6%84%EB%A6%AC-%EC%A0%84%EB%9E%B5%EC%9C%BC%EB%A1%9C-%EA%B0%95%ED%95%9C%EC%B5%9C%EC%A2%85-%EC%9D%BC%EA%B4%80%EC%84%B1-%EB%B3%B4%EC%9E%A5">ğŸ”— ê²°ì œ API - íŠ¸ëœì­ì…˜ ë¶„ë¦¬ ì „ëµìœ¼ë¡œ ê°•í•œ/ìµœì¢… ì¼ê´€ì„± ë³´ì¥</a></strong></p>
<ul>
<li><strong>ì¡°ê±´ 3 : ì‚¬ìš©ìëŠ” ì˜ˆì•½ì´ ì¦‰ì‹œ ì™„ë£Œë˜ê¸°ë¥¼ ê¸°ëŒ€í•˜ë¯€ë¡œ Time Outì„ ì„¤ì •í•´ì•¼ í•œë‹¤.</strong></li>
</ul>
<hr />
<h1 id="ìš”ì•½">[ìš”ì•½]</h1>
<blockquote>
<p>í•´ë‹¹ ê¸€ì—ì„œëŠ” <code>ì¡°ê±´ 3</code>ì„ ì¶©ì¡±í•˜ëŠ” ê³¼ì •ì„ ë‹´ê³  ìˆìœ¼ë©°, <code>ì¡°ê±´ 1</code>ê³¼ <code>ì¡°ê±´ 2</code>ë¥¼ ì¶©ì¡±í•˜ëŠ” ê³¼ì •ì€ 
<a href="https://velog.io/@ho-tea/%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EB%B6%84%EB%A6%AC-%EC%A0%84%EB%9E%B5%EC%9C%BC%EB%A1%9C-%EA%B0%95%ED%95%9C%EC%B5%9C%EC%A2%85-%EC%9D%BC%EA%B4%80%EC%84%B1-%EB%B3%B4%EC%9E%A5">ğŸ”— ê²°ì œ API - íŠ¸ëœì­ì…˜ ë¶„ë¦¬ ì „ëµìœ¼ë¡œ ê°•í•œ/ìµœì¢… ì¼ê´€ì„± ë³´ì¥</a>ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
</blockquote>
<p><strong>ì¡°ê±´ 3 : ì‚¬ìš©ìëŠ” ì˜ˆì•½ì´ ì¦‰ì‹œ ì™„ë£Œë˜ê¸°ë¥¼ ê¸°ëŒ€í•˜ë¯€ë¡œ Time Outì„ ì„¤ì •í•´ì•¼ í•œë‹¤.</strong></p>
<p><strong>ê²°ë¡ ì ìœ¼ë¡œ <code>Transaction timeout</code>ê³¼ <code>Http timeout</code>ì„ ì„¤ì •í•˜ëŠ”ê²ƒìœ¼ë¡œ í•´ê²°í•˜ì˜€ìŠµë‹ˆë‹¤.</strong></p>
<hr />
<h1 id="ë¬¸ì œ-ìƒí™©">[ë¬¸ì œ ìƒí™©]</h1>
<p><img alt="" src="https://velog.velcdn.com/images/ho-tea/post/d3ea0e28-0959-4fbc-a411-cb7a8c9a302b/image.png" /></p>
<p><strong>ì™¸ë¶€ ê²°ì œ APIì™€ ì˜ˆì•½/ê²°ì œ ì‚¬ì „ ì •ë³´ë¥¼ DBì— ì €ì¥í•˜ëŠ” ì‘ì—…</strong>ì„ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ê²Œ ë˜ë©´, ì™¸ë¶€ API í˜¸ì¶œì— ì†Œìš”ë˜ëŠ” ì§€ì—° ì‹œê°„ ë™ì•ˆ ë‚´ë¶€ DB ì»¤ë„¥ì…˜ì´ ê³„ì†í•´ì„œ ì ìœ ë˜ë¯€ë¡œ ì»¤ë„¥ì…˜ ê³ ê°ˆ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p><img alt="" src="https://velog.velcdn.com/images/ho-tea/post/3fedc6bc-798d-474f-9b0a-2f4c578306e5/image.png" /></p>
<p>ì´ëŸ¬í•œ ìƒí™©ì€ ë‚´ë¶€ DB ì ‘ê·¼ì— ì œì•½ì„ ì£¼ì–´ <strong>ì „ì²´ ì‹œìŠ¤í…œì˜ ì„±ëŠ¥ ì €í•˜ ë° ì¥ì• ë¡œ ì´ì–´ì§ˆ ìœ„í—˜</strong>ì´ ìˆë‹¤ê³  íŒë‹¨í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
<p>ë˜í•œ <strong>ì‚¬ìš©ìëŠ” ì˜ˆì•½ì´ ì¦‰ì‹œ ì™„ë£Œë˜ê¸°ë¥¼ ê¸°ëŒ€í•˜ì§€ë§Œ,</strong> ì§€ì—° ì‹œê°„ ë™ì•ˆ ì‚¬ìš©ì ê²½í—˜ì´ ì €í•˜ë˜ì–´ ë¶ˆë§Œì´ ìŒ“ì´ê³ , ì´ëŠ” ê¶ê·¹ì ìœ¼ë¡œ ê³ ê° ì´íƒˆë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆë‹¤ê³  íŒë‹¨í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
<hr />
<h1 id="í•´ê²°-ë°©ì•ˆ">[í•´ê²° ë°©ì•ˆ]</h1>
<ul>
<li><strong>Transaction timeout</strong> : ë‚´ë¶€ DB ì‘ì—…ì˜ ì‹œê°„ ì œí•œì„ í†µí•´ ë°ì´í„° ë¬´ê²°ì„±ì„ ë³´ì¥</li>
<li><strong>Http timeout :</strong> ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ì˜ í†µì‹ ì—ì„œ ì‘ë‹µ ì§€ì—°ì„ ë°©ì§€</li>
</ul>
<h2 id="âœ…-transaction-timeout">âœ…Â [Transaction Timeout]</h2>
<blockquote>
<p>ì™¸ë¶€ ê²°ì œ API í˜¸ì¶œ ì „ì— <strong>DBì— ì˜ˆì•½/ê²°ì œ ì‚¬ì „ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ì‘ì—…ê³¼ ì™¸ë¶€ ê²°ì œ API í˜¸ì¶œì€ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜</strong>ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³ , ê·¸ í›„ <strong>ì˜ˆì•½/ê²°ì œ ìƒì„¸ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ì‘ì—…</strong>ì€ <code>ë³„ë„ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¶„ë¦¬</code></p>
</blockquote>
<pre><code class="language-java">// ReservationFacade.java

public ReservationPaymentResponse saveReservationPayment(
        LoginMember loginMember,
        ReservationPaymentRequest reservationPaymentRequest
) {
    ReservationPaymentResult reservationPaymentResult = reservationApplicationService.saveAdvanceReservationPayment(loginMember, reservationPaymentRequest);
    try {
        return reservationApplicationService.saveDetailedReservationPayment(reservationPaymentResult.reservation(), reservationPaymentResult.paymentResult());
    } catch (Exception e) {
        return new ReservationPaymentResponse(
                ReservationResponse.from(reservationPaymentResult.reservation()),
                PaymentResponse.from(reservationPaymentResult.paymentResult()));
    }
}

// ReservationApplicationService.java

**// [ì‚¬ì „ ì˜ˆì•½ ì •ë³´ &amp; ê²°ì œ ì •ë³´ DB ì €ì¥]**
**@Transactional(propagation = Propagation.REQUIRES_NEW, timeout = 6)**
public ReservationPaymentResult saveAdvanceReservationPayment(LoginMember loginMember, ReservationPaymentRequest reservationPaymentRequest) {
    Reservation reservation = reservationService.saveAdvanceReservationPayment(loginMember, reservationPaymentRequest.toReservationRequest(), reservationPaymentRequest.toPaymentRequest());
    PaymentResult paymentResult = paymentClient.purchase(reservationPaymentRequest.toPaymentRequest());
    return new ReservationPaymentResult(reservation, paymentResult);
}

**// [ìƒì„¸ ì˜ˆì•½ ì •ë³´ &amp; ê²°ì œ ì •ë³´ DB ì €ì¥]**
**@Transactional(propagation = Propagation.REQUIRES_NEW, timeout = 1)**
public ReservationPaymentResponse saveDetailedReservationPayment(
        Reservation reservation,
        PaymentResult paymentResult
) {
    return reservationService.confirmReservationPayment(reservation, paymentResult);
}</code></pre>
<p>ê° íŠ¸ëœì­ì…˜ì— <code>timeout</code>ì„ ì„¤ì •í•¨ìœ¼ë¡œì¨ ë¹„ì •ìƒì ì¸ ì§€ì—° ìƒí™©ì—ì„œ ìì› ì ìœ ë¥¼ ì œí•œí•˜ê³ , ì‹œìŠ¤í…œ ì „ì²´ì˜ <strong>ì‘ë‹µì„±</strong>ì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<blockquote>
<p>ë°ì´í„°ë² ì´ìŠ¤ì— ì—¬ëŸ¬ ë ˆì½”ë“œë¥¼ ì‚½ì…í•˜ê³  ì™¸ë¶€ ê²°ì œ ì‹œìŠ¤í…œê³¼ í†µì‹ í•˜ëŠ” ë“± ìƒëŒ€ì ìœ¼ë¡œ ì‹œê°„ì´ ì†Œìš”ë  ìˆ˜ ìˆëŠ” ì‘ì—… â†’ <code>timeout 6ì´ˆ</code>
ì‘ë‹µ ì§€ì—° ì—†ì´ ë¹ ë¥´ê²Œ ì‘ì—…ì´ ì™„ë£Œë˜ì–´ì•¼ í•˜ëŠ” ì‘ì—… â†’ <code>timeout 1ì´ˆ</code></p>
</blockquote>
<h2 id="âœ…-http-timeout">âœ…Â [Http Timeout]</h2>
<pre><code class="language-java">// RestClientConfig.java

// ì»¤ë„¥ì…˜ í’€ ë§¤ë‹ˆì € ìƒì„± ë©”ì„œë“œ
private PoolingHttpClientConnectionManager getPoolingHttpClientConnectionManager() {
    // ì»¤ë„¥ì…˜ êµ¬ì„±: **ì»¤ë„¥ì…˜ ìƒì„± ë° ì†Œì¼“ íƒ€ì„ì•„ì›ƒì„ ì„¤ì •**
    ConnectionConfig connectionConfig = ConnectionConfig.custom()
            .setConnectTimeout(connectionTimeOut)
            .setSocketTimeout(socketTimeOut)
            .build();

    return PoolingHttpClientConnectionManagerBuilder.create()
            .setDefaultConnectionConfig(connectionConfig)
            .build();
}

// ìš”ì²­ íƒ€ì„ì•„ì›ƒ ì„¤ì • ë©”ì„œë“œ
private RequestConfig getRequestConfig() {
    **// ì‘ë‹µ ìˆ˜ì‹  ì‹œê°„ ì œí•œ(read timeout)ì„ ì„¤ì •**
    return RequestConfig.custom()
            .setResponseTimeout(readTimeOut)
            .build();
}

// HttpClient ìƒì„± ë©”ì„œë“œ
private CloseableHttpClient getHttpClient(PoolingHttpClientConnectionManager connManager, RequestConfig requestConfig) {
    return HttpClients.custom()
            .setConnectionManager(connManager) // ì»¤ë„¥ì…˜ í’€ ë§¤ë‹ˆì €ë¥¼ ì‚¬ìš©í•˜ì—¬ ì»¤ë„¥ì…˜ ì¬ì‚¬ìš©
            .setDefaultRequestConfig(requestConfig) // ìš”ì²­ ê´€ë ¨ íƒ€ì„ì•„ì›ƒ ì„¤ì • ì ìš©
            **// ì¬ì‹œë„ ì „ëµ ì„¤ì •: ìµœëŒ€ 3íšŒ ì¬ì‹œë„, 1ì´ˆ ê°„ê²©ìœ¼ë¡œ ì¬ì‹œë„**
            .setRetryStrategy(new DefaultHttpRequestRetryStrategy(3, Timeout.ofSeconds(1)))
            .build();
}</code></pre>
<p>ì§€ì—°ì‹œê°„ì„ ì œí•œí•˜ê¸° ìœ„í•´ <code>Connection Timeout</code>, <code>Socket Timeout</code>, <code>Read Timeout</code>ì„ ì„¤ì •í•˜ì—¬ ì •í•´ì§„ ì‘ë‹µ ì‹œê°„ ë‚´ì— ì‘ë‹µì´ ì˜¤ì§€ ì•Šìœ¼ë©´ í˜¸ì¶œì´ ì‹¤íŒ¨ì²˜ë¦¬í•˜ëŠ” ê²ƒìœ¼ë¡œ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ë˜í•œ, ì¼ì‹œì ì¸ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë‚˜ ì„œë²„ ê³¼ë¶€í•˜ë¡œ ì¸í•´ ì™¸ë¶€ API í˜¸ì¶œì´ ì‹¤íŒ¨í•  ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬, ì§€ì •ëœ íšŸìˆ˜ë§Œí¼ ì¬ì‹œë„í•˜ëŠ” <code>Retry</code> ë¡œì§ì„ ì¶”ê°€ë¡œ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
<blockquote>
<p><code>ConnectionTimeOut</code>Â : 3ì´ˆ</p>
<ul>
<li>ëŒ€ë¶€ë¶„ì˜ ì‹œìŠ¤í…œì—ì„œÂ <code>InitRTO</code>ì˜ ê°’ì´ 1ì´ˆë¡œ ì„¤ì •ë˜ì–´ ìˆë‹¤ê³  íŒë‹¨ (<a href="https://datatracker.ietf.org/doc/html/rfc6298">RFC 6298</a>)</li>
<li><code>Syn</code>Â íŒ¨í‚· ìœ ì‹¤,Â <code>Syn + Ack</code>Â íŒ¨í‚· ìœ ì‹¤,Â <code>Ack</code>Â íŒ¨í‚· ìœ ì‹¤ ê³¼ ê°™ì´ ì—°ê²°ì´ ì§€ì—°ë˜ì–´ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°ë¥¼ 3ê°€ì§€ë¡œ íŒë‹¨í•˜ì—¬ 3ì´ˆë¡œ ì„¤ì •</li>
</ul>
<p><code>ReadTimeOut</code>Â : 30ì´ˆ</p>
<ul>
<li>í•´ë‹¹ ë¶€ë¶„ì€Â <a href="https://docs.tosspayments.com/resources/glossary/timeout">í† ìŠ¤ í˜ì´ë¨¼ì¸ </a>ì— ê¸°ìˆ ë˜ì–´ìˆëŠ” ê²ƒì„ í™•ì¸í•˜ì—¬ 30ì´ˆë¡œ êµ¬ì„±</li>
</ul>
<p><code>SocketTimeOut</code>Â : 2ì´ˆ</p>
<ul>
<li>íŒ¨í‚· í•˜ë‚˜ê°€ ìœ ì‹¤ë˜ê³  ë‹¤ì‹œ ì¬ì „ì†¡ë˜ê¸°ê¹Œì§€ì˜ ì‹œê°„ì„ ê³ ë ¤í•˜ì—¬ êµ¬ì„±</li>
</ul>
</blockquote>
<hr />
<h1 id="ê²°ë¡ ">[ê²°ë¡ ]</h1>
<p><img alt="" src="https://velog.velcdn.com/images/ho-tea/post/5f0b41fa-0991-4be1-bd66-1cb57943cf0b/image.png" /></p>
<p>ì™¸ë¶€ APIì™€ ë‚´ë¶€ DB ì‘ì—…ì„ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ê²Œ ë˜ë©´, ì™¸ë¶€ API í˜¸ì¶œì— ì†Œìš”ë˜ëŠ” ì§€ì—° ì‹œê°„ ë™ì•ˆ ë‚´ë¶€ DB ì»¤ë„¥ì…˜ì´ ê³„ì† ì ìœ ë˜ì–´ ì»¤ë„¥ì…˜ ê³ ê°ˆ ë¬¸ì œê°€ ë°œìƒí•  ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, <strong>ì‚¬ìš©ìëŠ” ì˜ˆì•½ì´ ì¦‰ì‹œ ì™„ë£Œë˜ê¸°ë¥¼ ê¸°ëŒ€í•˜ì§€ë§Œ</strong>, ì´ëŸ¬í•œ ì§€ì—°ìœ¼ë¡œ ì¸í•´ ì‘ë‹µ ì‹œê°„ì´ ê¸¸ì–´ì§€ë©´ ì‚¬ìš©ì ê²½í—˜ì´ í¬ê²Œ ì €í•˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´, </p>
<ul>
<li>ê° íŠ¸ëœì­ì…˜ì— <code>timeout</code>ì„ ì„¤ì •í•¨ìœ¼ë¡œì¨ ë¹„ì •ìƒì ì¸ ì§€ì—° ìƒí™©ì—ì„œ ìì› ì ìœ ë¥¼ ì œí•œí•˜ê³ , ì‹œìŠ¤í…œ ì „ì²´ì˜ <strong>ì‘ë‹µì„±</strong>ì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
</ul>
<p><img alt="" src="https://velog.velcdn.com/images/ho-tea/post/fcb8c6b0-f923-4152-9daa-af3610674a51/image.png" /></p>
<ul>
<li><code>Connection Timeout</code>, <code>Socket Timeout</code>, <code>Read Timeout</code>ì„ ì„¤ì •í•˜ì—¬ ê° ë‹¨ê³„ì˜ ì§€ì—° ì‹œê°„ì„ ì œí•œí–ˆìŠµë‹ˆë‹¤. ë˜í•œ, ì¼ì‹œì ì¸ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë‚˜ ì„œë²„ ê³¼ë¶€í•˜ë¡œ ì¸í•´ ì™¸ë¶€ API í˜¸ì¶œì´ ì‹¤íŒ¨í•  ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬, ì§€ì •ëœ íšŸìˆ˜ë§Œí¼ ì¬ì‹œë„í•˜ëŠ” <code>Retry</code> ë¡œì§ì„ ì¶”ê°€ë¡œ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.</li>
</ul>